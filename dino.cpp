#include <Arduino.h>
#include <SPI.h>
#include <Wire.h>
#include <U8g2lib.h>

U8G2_ST7920_128X64_1_HW_SPI u8g2(U8G2_R0, 10, 8);

uint8_t button_jump = 4;

#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64

#define DINO_WIDTH 4
#define DINO_HEIGHT 26
#define DINO_INIT_X 10
#define DINO_INIT_Y 29

#define BASE_LINE_X0 0
#define BASE_LINE_Y0 54
#define BASE_LINE_X1 127
#define BASE_LINE_Y1 54

#define TREE1_WIDTH 2
#define TREE1_HEIGHT 23
#define TREE2_WIDTH 3
#define TREE2_HEIGHT 23
#define TREE_Y 35

#define JUMP_PIXEL 22

/*bitmaps*/
static const unsigned char dino1[] = {
  // 'dino', 25x26px
0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xfe, 0x00, 0x00, 0x06, 0xff, 0x00, 0x00, 0x0e, 0xff, 0x00, 
0x00, 0x0f, 0xff, 0x00, 0x00, 0x0f, 0xff, 0x00, 0x00, 0x0f, 0xff, 0x00, 0x00, 0x0f, 0xc0, 0x00, 
0x00, 0x0f, 0xfc, 0x00, 0x40, 0x0f, 0xc0, 0x00, 0x40, 0x1f, 0x80, 0x00, 0x40, 0x7f, 0x80, 0x00, 
0x60, 0xff, 0xe0, 0x00, 0x71, 0xff, 0xa0, 0x00, 0x7f, 0xff, 0x80, 0x00, 0x7f, 0xff, 0x80, 0x00, 
0x7f, 0xff, 0x80, 0x00, 0x3f, 0xff, 0x00, 0x00, 0x1f, 0xff, 0x00, 0x00, 0x0f, 0xfe, 0x00, 0x00, 
0x03, 0xfc, 0x00, 0x00, 0x01, 0xdc, 0x00, 0x00, 0x01, 0x8c, 0x00, 0x00, 0x01, 0x8c, 0x00, 0x00, 
0x01, 0x0c, 0x00, 0x00, 0x01, 0x8e, 0x00, 0x00
};

static const unsigned char tree1[] = {
  // 'tree1', 11x23px
0x1e, 0x00, 0x1f, 0x00, 0x1f, 0x40, 0x1f, 0xe0, 0x1f, 0xe0, 0xdf, 0xe0, 0xff, 0xe0, 0xff, 0xe0, 
0xff, 0xe0, 0xff, 0xe0, 0xff, 0xe0, 0xff, 0xe0, 0xff, 0xc0, 0xff, 0x00, 0xff, 0x00, 0x7f, 0x00, 
0x1f, 0x00, 0x1f, 0x00, 0x1f, 0x00, 0x1f, 0x00, 0x1f, 0x00, 0x1f, 0x00, 0x1f, 0x00
};

static const unsigned char tree2[] = {
  // 'tree2', 22x23px
0x1e, 0x01, 0xe0, 0x1f, 0x03, 0xe0, 0x1f, 0x4f, 0xe8, 0x1f, 0xff, 0xfc, 0x1f, 0xff, 0xfc, 0xdf, 
0xff, 0xfc, 0xff, 0xff, 0xfc, 0xff, 0xff, 0xfc, 0xff, 0xff, 0xfc, 0xff, 0xff, 0xfc, 0xff, 0xff, 
0xfc, 0xff, 0xef, 0xfc, 0xff, 0x83, 0xfc, 0xff, 0x03, 0xfc, 0xff, 0x03, 0xf8, 0x7f, 0x03, 0xe0, 
0x1f, 0x03, 0xe0, 0x1f, 0x03, 0xe0, 0x1f, 0x03, 0xe0, 0x1f, 0x03, 0xe0, 0x1f, 0x03, 0xe0, 0x1f, 
0x03, 0xe0, 0x1f, 0x03, 0xe0
};

/*game*/

void setup()
{
    u8g2.begin();
    u8g2.clearDisplay();
    u8g2.setDrawColor(1);
    u8g2.setBitmapMode(1);
    play();
}

void play()
{
    uint16_t tree_x = 127;
    uint16_t tree1_x = 195;

    uint8_t tree_type = random(0,2);
    uint8_t tree_type1 = random(0,2);

    uint16_t dino_y = DINO_INIT_Y;

    uint8_t jump = 0;

    for(;;)
    {
        if(digitalRead(button_jump) == HIGH)
        {
            if(jump == 0)
            {
                jump = 1;
            }
        }

        if(jump == 1)
        {
            dino_y--;
            if(dino_y == (DINO_INIT_Y-JUMP_PIXEL))
            {
                jump = 2;
            }
        }
        else if(jump == 2)
        {
            dino_y++;
            if(dino_y == (DINO_INIT_Y))
            {
                jump = 0;
            }
        }
        
        u8g2.firstPage();
        do
        {
            moveTree(&tree_x, tree_type);
            moveTree(&tree1_x, tree_type1);
            moveDino(&dino_y);
            u8g2.drawLine(0,54,127,54);

            tree_x--;
            tree1_x--;

            if(tree_x == 0)
            {
                tree_x = 127;
                tree_type = random(0,2);
            }

            if(tree1_x == 0)
            {
                tree1_x = 195;
                tree_type1 = random(0,2);
            }
            u8g2.display();
        } while(u8g2.nextPage());
    }   
}

void moveTree(int16_t *x, int type)
{
    if(type == 0)
    {
        u8g2.drawBitmap(*x, TREE_Y, TREE1_WIDTH, TREE1_HEIGHT, tree1);
    }
    else if(type == 1)
    {
        u8g2.drawBitmap(*x, TREE_Y, TREE2_WIDTH, TREE2_HEIGHT, tree2);
    }
}

void moveDino(int16_t *y)
{
    u8g2.drawBitmap(DINO_INIT_X, *y, DINO_WIDTH, DINO_HEIGHT, dino1);
}

void loop()
{

}